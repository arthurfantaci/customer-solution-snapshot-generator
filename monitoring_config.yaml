# Monitoring Configuration for Customer Solution Snapshot Generator
# This file defines monitoring, alerting, and health check settings

# Health Monitoring Configuration
health_monitoring:
  enabled: true
  check_interval: 30  # seconds
  checks:
    system_resources:
      enabled: true
      cpu_warning_threshold: 70.0
      cpu_critical_threshold: 90.0
      memory_warning_threshold: 80.0
      memory_critical_threshold: 95.0
      disk_warning_threshold: 80.0
      disk_critical_threshold: 95.0
    
    application:
      enabled: true
      memory_limit_mb: 2048
      response_time_threshold_ms: 5000
      
    dependencies:
      enabled: true
      check_apis: true
      check_filesystem: true
      check_python_environment: true
      
    performance:
      enabled: true
      processing_time_threshold_ms: 5000
      memory_growth_threshold_mb: 100

# System Monitoring Configuration
system_monitoring:
  enabled: true
  collection_interval: 10  # seconds
  metrics_retention: 86400  # 24 hours in seconds
  
  # Prometheus integration
  prometheus:
    enabled: false
    port: 8081
    path: "/metrics"
    
  # Metrics to collect
  metrics:
    system_metrics: true
    application_metrics: true
    business_metrics: true
    custom_metrics: true

# Alerting Configuration
alerting:
  enabled: true
  aggregation_window: 300  # 5 minutes
  
  # Alert Rules
  rules:
    - name: "high_cpu_usage"
      metric: "system_cpu_usage_percent"
      condition: "greater_than"
      threshold: 85.0
      severity: "warning"
      message: "High CPU usage detected"
      
    - name: "critical_cpu_usage"
      metric: "system_cpu_usage_percent"
      condition: "greater_than"
      threshold: 95.0
      severity: "critical"
      message: "Critical CPU usage detected"
      
    - name: "high_memory_usage"
      metric: "system_memory_usage_percent"
      condition: "greater_than"
      threshold: 80.0
      severity: "warning"
      message: "High memory usage detected"
      
    - name: "critical_memory_usage"
      metric: "system_memory_usage_percent"
      condition: "greater_than"
      threshold: 95.0
      severity: "critical"
      message: "Critical memory usage detected"
      
    - name: "high_disk_usage"
      metric: "system_disk_usage_percent"
      condition: "greater_than"
      threshold: 85.0
      severity: "warning"
      message: "High disk usage detected"
      
    - name: "critical_disk_usage"
      metric: "system_disk_usage_percent"
      condition: "greater_than"
      threshold: 95.0
      severity: "critical"
      message: "Critical disk usage detected"
      
    - name: "application_memory_high"
      metric: "application_memory_usage_percent"
      condition: "greater_than"
      threshold: 75.0
      severity: "warning"
      message: "Application using high memory"
      
    - name: "health_check_failed"
      metric: "health_check_status"
      condition: "equals"
      threshold: 0  # 0 = failed, 1 = success
      severity: "critical"
      message: "Health check failed"

# Notification Channels
notifications:
  # Email notifications
  email:
    enabled: false
    smtp_server: "smtp.gmail.com"
    smtp_port: 587
    use_tls: true
    username: ""  # Set via environment variable
    password: ""  # Set via environment variable
    from_email: "alerts@example.com"
    recipients:
      - "admin@example.com"
      - "ops-team@example.com"
    severity_filter: ["warning", "critical", "emergency"]
    
  # Slack notifications
  slack:
    enabled: false
    webhook_url: ""  # Set via environment variable
    channel: "#alerts"
    username: "Customer Snapshot Monitor"
    icon_emoji: ":warning:"
    severity_filter: ["warning", "critical", "emergency"]
    
  # Generic webhook notifications
  webhook:
    enabled: false
    url: ""  # Set via environment variable
    method: "POST"
    headers:
      Content-Type: "application/json"
    timeout: 10
    severity_filter: ["info", "warning", "critical", "emergency"]
    
  # PagerDuty integration
  pagerduty:
    enabled: false
    integration_key: ""  # Set via environment variable
    severity_filter: ["critical", "emergency"]

# Escalation Policies
escalation:
  rules:
    - name: "critical_escalation"
      condition: "time_based"
      threshold: 15  # minutes
      action: "escalate"
      target: "emergency"
      
    - name: "repeated_warnings"
      condition: "retry_count"
      threshold: 5
      action: "escalate"
      target: "critical"
      
    - name: "business_hours_only"
      condition: "time_window"
      threshold: "09:00-17:00"  # Business hours
      action: "suppress"
      
    - name: "maintenance_window"
      condition: "maintenance_mode"
      threshold: true
      action: "suppress"

# Logging Configuration
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  handlers:
    - console
    - file
  file_config:
    filename: "/app/logs/monitoring.log"
    max_bytes: 10485760  # 10MB
    backup_count: 5
    
# Performance Monitoring
performance:
  enabled: true
  benchmarking:
    enabled: false
    interval: 3600  # hourly
    test_sizes: [0.5, 1.0, 2.0]  # MB
    
  memory_optimization:
    enabled: true
    monitoring_interval: 30
    gc_frequency: 1000
    streaming_threshold_mb: 10
    
  response_time_tracking:
    enabled: true
    percentiles: [50, 90, 95, 99]
    histogram_buckets: [0.1, 0.5, 1.0, 2.5, 5.0, 10.0]

# Dashboard Configuration
dashboard:
  enabled: true
  refresh_interval: 5  # seconds
  port: 8080
  
  # Features
  features:
    health_overview: true
    system_metrics: true
    performance_charts: true
    alert_history: true
    log_viewer: true
    
  # Chart configurations
  charts:
    time_window: 3600  # 1 hour
    data_points: 300
    auto_refresh: true

# Integration Settings
integrations:
  # Prometheus integration
  prometheus:
    enabled: false
    push_gateway: ""
    job_name: "customer_snapshot_generator"
    push_interval: 60  # seconds
    
  # Grafana integration
  grafana:
    enabled: false
    dashboard_url: ""
    api_key: ""  # Set via environment variable
    
  # External monitoring systems
  external_monitoring:
    enabled: false
    datadog:
      enabled: false
      api_key: ""  # Set via environment variable
      app_key: ""  # Set via environment variable
      
    new_relic:
      enabled: false
      license_key: ""  # Set via environment variable
      
    elastic_apm:
      enabled: false
      server_url: ""
      secret_token: ""  # Set via environment variable

# Security and Access Control
security:
  # API authentication for monitoring endpoints
  api_auth:
    enabled: false
    method: "token"  # token, basic, oauth
    tokens:
      - "monitoring_token_123"  # Set via environment variable
      
  # Access logging
  access_logging:
    enabled: true
    log_requests: true
    log_responses: false
    
  # Rate limiting
  rate_limiting:
    enabled: false
    requests_per_minute: 100
    
# Environment-specific overrides
environments:
  development:
    health_monitoring:
      check_interval: 60
    system_monitoring:
      collection_interval: 30
    alerting:
      enabled: false
      
  staging:
    notifications:
      email:
        enabled: true
        recipients: ["staging-alerts@example.com"]
      slack:
        enabled: true
        channel: "#staging-alerts"
        
  production:
    health_monitoring:
      check_interval: 10
    system_monitoring:
      collection_interval: 5
    alerting:
      enabled: true
    notifications:
      email:
        enabled: true
      slack:
        enabled: true
      pagerduty:
        enabled: true
    performance:
      benchmarking:
        enabled: true